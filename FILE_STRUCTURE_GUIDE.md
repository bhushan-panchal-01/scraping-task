# Complete File Structure & Data Flow Guide

## ğŸ“ Project Structure

```
data-scrapping-api/
â”‚
â”œâ”€â”€ ğŸ“„ INPUT FILES (What You Provide)
â”‚   â”œâ”€â”€ influencers.csv          â† List of influencers to scrape
â”‚   â”‚   OR
â”‚   â””â”€â”€ influencer names.xlsx     â† Excel version (legacy)
â”‚
â”œâ”€â”€ ğŸ“„ OUTPUT FILES (Generated by System)
â”‚   â”œâ”€â”€ influencers.csv           â† Updated with average views
â”‚   â”œâ”€â”€ posts.csv                 â† All scraped posts data
â”‚   â”‚   OR
â”‚   â””â”€â”€ influencer names.xlsx     â† Excel version (if using Excel)
â”‚
â”œâ”€â”€ ğŸ“ backups/                   â† Automatic backups before each update
â”‚   â””â”€â”€ influencers.csv.2024-01-29_22-15-30.csv
â”‚
â”œâ”€â”€ ğŸ“ logs/                      â† System logs
â”‚   â”œâ”€â”€ combined.log             â† All logs
â”‚   â””â”€â”€ error.log                â† Errors only
â”‚
â”œâ”€â”€ ğŸ“ src/                       â† Source code
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ config.js            â† Configuration
â”‚   â”œâ”€â”€ jobs/
â”‚   â”‚   â””â”€â”€ scrapingJob.js       â† Main job orchestrator
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ scrapers/            â† Scraping logic
â”‚   â”‚   â”œâ”€â”€ fileIO/              â† File read/write
â”‚   â”‚   â””â”€â”€ browser/             â† Browser automation
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ dataProcessor.js     â† Data processing
â”‚
â””â”€â”€ ğŸ“„ .env                       â† Environment configuration
```

---

## ğŸ“¥ INPUT FILES

### Option 1: CSV Format (Recommended)

#### `influencers.csv` - Input File
```csv
username,platform,average views
charlidamelio,tiktok,
cristiano,instagram,
selenagomez,instagram,
```

**Required Columns:**
- `username` - Social media username (without @)
- `platform` - Either `tiktok` or `instagram`
- `average views` - Can be empty initially (will be calculated)

**Example:**
```csv
username,platform,average views
charlidamelio,tiktok,
cristiano,instagram,
khaby00,tiktok,
```

### Option 2: Excel Format (Legacy)

#### `influencer names.xlsx` - Sheet "main"
| username | platform | average views |
|----------|----------|---------------|
| charlidamelio | tiktok | |
| cristiano | instagram | |
| khaby00 | tiktok | |

---

## ğŸ“¤ OUTPUT FILES

### CSV Format Output

#### 1. `influencers.csv` - Updated Input File
```csv
username,platform,average views
charlidamelio,tiktok,2500000
cristiano,instagram,1500000
khaby00,tiktok,1800000
```

**What Changed:**
- âœ… `average views` column is now filled with calculated values
- âœ… Based on last 10 posts per influencer

#### 2. `posts.csv` - All Scraped Posts
```csv
username,platform,post link,posted date,views,likes,share
charlidamelio,tiktok,https://tiktok.com/@charlidamelio/video/123,2024-01-29T10:30:00Z,3000000,500000,25000
charlidamelio,tiktok,https://tiktok.com/@charlidamelio/video/124,2024-01-28T15:20:00Z,2800000,450000,22000
cristiano,instagram,https://instagram.com/p/abc123,2024-01-29T12:00:00Z,2000000,800000,15000
```

**Columns:**
- `username` - Influencer username
- `platform` - Platform name
- `post link` - Direct URL to the post
- `posted date` - ISO format date/time
- `views` - Number of views
- `likes` - Number of likes
- `share` - Number of shares/shares

### Excel Format Output

#### `influencer names.xlsx` - Two Sheets

**Sheet 1: "main"** (Updated)
| username | platform | average views |
|----------|----------|---------------|
| charlidamelio | tiktok | 2500000 |
| cristiano | instagram | 1500000 |

**Sheet 2: "post link"** (All Posts)
| username | post link | posted date | views | likes | share |
|----------|-----------|-------------|-------|-------|-------|
| charlidamelio | https://tiktok.com/... | 2024-01-29T10:30:00Z | 3000000 | 500000 | 25000 |

---

## ğŸ”„ DATA FLOW

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INPUT PHASE                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Read influencers.csv           â”‚
        â”‚  (or Excel "main" sheet)        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Read existing posts.csv        â”‚
        â”‚  (or Excel "post link" sheet)    â”‚
        â”‚  (for deduplication)            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SCRAPING PHASE                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                   â”‚
        â–¼                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Instagram   â”‚                  â”‚    TikTok    â”‚
â”‚  (RapidAPI)  â”‚                  â”‚ (Web Scrape) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Process & Normalize Data       â”‚
        â”‚  - Calculate average views       â”‚
        â”‚  - Filter last 10 posts          â”‚
        â”‚  - Deduplicate posts             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OUTPUT PHASE                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                   â”‚
        â–¼                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Create Backup    â”‚            â”‚ Update Files     â”‚
â”‚ (before write)    â”‚            â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  influencers.csv               â”‚
        â”‚  - Updated average views        â”‚
        â”‚                                 â”‚
        â”‚  posts.csv                      â”‚
        â”‚  - New posts appended           â”‚
        â”‚  - Existing posts updated       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š DATA PROCESSING DETAILS

### 1. Average Views Calculation
- Takes **last 10 posts** per influencer
- Calculates average of `views` column
- Updates `average views` in influencers file

### 2. Post Deduplication
- Compares new posts with existing posts
- Uses `post link` as unique identifier
- **New posts**: Added to file
- **Existing posts**: Updated if metrics changed

### 3. Data Normalization
- Standardizes date formats (ISO 8601)
- Converts numbers (handles "1.2K" â†’ 1200)
- Normalizes platform names (tiktok, instagram)

---

## ğŸ”§ CONFIGURATION FILES

### `.env` File
```bash
# Scraping Configuration
RAPIDAPI_KEY=your_key_here
INSTAGRAM_SCRAPING_METHOD=rapidapi
TIKTOK_SCRAPING_METHOD=web

# File Paths
INFLUENCER_CSV_PATH=./influencers.csv
POSTS_CSV_PATH=./posts.csv
# OR for Excel:
# EXCEL_FILE_PATH=./influencer names.xlsx

# Proxy (Optional)
PROXY_ENABLED=false
PROXY_HOST=us.decodo.com
PROXY_PORT=10001
PROXY_USERNAME=bhushan
PROXY_PASSWORD=Qz2q2ovEF7h2~Lkept

# Performance
MAX_CONCURRENT_REQUESTS=3
BROWSER_TIMEOUT=60000

# Schedule
CRON_SCHEDULE=0 */6 * * *
```

---

## ğŸ“ EXAMPLE: Complete Workflow

### Step 1: Prepare Input
Create `influencers.csv`:
```csv
username,platform,average views
charlidamelio,tiktok,
cristiano,instagram,
```

### Step 2: Run Scraper
```bash
npm run scrape-now
```

### Step 3: Check Output

**influencers.csv** (Updated):
```csv
username,platform,average views
charlidamelio,tiktok,2500000
cristiano,instagram,1500000
```

**posts.csv** (Created/Updated):
```csv
username,platform,post link,posted date,views,likes,share
charlidamelio,tiktok,https://tiktok.com/@charlidamelio/video/123,2024-01-29T10:30:00Z,3000000,500000,25000
cristiano,instagram,https://instagram.com/p/abc123,2024-01-29T12:00:00Z,2000000,800000,15000
```

**backups/** (Automatic):
```
backups/influencers.csv.2024-01-29_22-15-30.csv
backups/posts.csv.2024-01-29_22-15-30.csv
```

---

## ğŸ” FILE FORMAT DETECTION

The system **auto-detects** format by file extension:

| Extension | Format | Files Used |
|-----------|--------|------------|
| `.csv` | CSV | `influencers.csv` + `posts.csv` |
| `.xlsx` | Excel | `influencer names.xlsx` (2 sheets) |
| `.xls` | Excel | `influencer names.xlsx` (2 sheets) |

**Detection Logic:**
```javascript
if (file.endsWith('.csv')) {
  // Use CSV format
  // Read: influencers.csv, posts.csv
  // Write: influencers.csv, posts.csv
} else if (file.endsWith('.xlsx')) {
  // Use Excel format
  // Read: Sheet "main", Sheet "post link"
  // Write: Sheet "main", Sheet "post link"
}
```

---

## ğŸ’¾ BACKUP SYSTEM

### Automatic Backups
- Created **before every write operation**
- Stored in `backups/` directory
- Format: `filename.YYYY-MM-DD_HH-MM-SS.ext`

### Example Backup Files
```
backups/
â”œâ”€â”€ influencers.csv.2024-01-29_22-15-30.csv
â”œâ”€â”€ posts.csv.2024-01-29_22-15-30.csv
â””â”€â”€ influencer names.xlsx.2024-01-29_22-15-30.xlsx
```

### Restore from Backup
```bash
# Restore influencers.csv
cp backups/influencers.csv.2024-01-29_22-15-30.csv ./influencers.csv

# Restore posts.csv
cp backups/posts.csv.2024-01-29_22-15-30.csv ./posts.csv
```

---

## ğŸ“ˆ DATA UPDATES

### What Gets Updated

1. **Average Views** (influencers file)
   - Calculated from last 10 posts
   - Updated every run

2. **New Posts** (posts file)
   - Appended to end of file
   - Never deleted (historical data)

3. **Existing Posts** (posts file)
   - Updated if metrics changed
   - Same `post link` = update, not duplicate

### Update Frequency
- Controlled by `CRON_SCHEDULE` in `.env`
- Default: Every 6 hours (`0 */6 * * *`)
- Can run manually: `npm run scrape-now`

---

## ğŸ¯ KEY POINTS

1. **Input**: `influencers.csv` with username and platform
2. **Output**: 
   - Updated `influencers.csv` (with average views)
   - `posts.csv` (all scraped posts)
3. **Backups**: Automatic before each update
4. **Format**: Auto-detected by file extension
5. **Deduplication**: Uses `post link` as unique ID
6. **Average Views**: Calculated from last 10 posts

---

## ğŸš€ Quick Start

1. **Create input file**: `influencers.csv`
2. **Run scraper**: `npm run scrape-now`
3. **Check output**: `influencers.csv` and `posts.csv`
4. **View logs**: `logs/combined.log`
5. **Check backups**: `backups/` directory

That's it! The system handles everything else automatically.
